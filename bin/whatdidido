#!/bin/bash

repos=~/Documents/one
name=$(whoami)
yesterday=$(date -d "yesterday" "+%Y-%m-%d")

verbose=false

print_commit() {
  local sha=$1
  git show --oneline --name-only $sha
}

print_commits() {
    if ! [ -d ".git" ]; then
        return
    fi

    local repo_folder=$1
    local commits=$(git log --committer="$name" --since="$yesterday" --oneline)

    if [ "$commits" ]; then
        tput bold && echo $repo_folder && tput sgr0

        if $verbose; then
          for commit in $(echo "$commits" | awk '{print $1}'); do
            print_commit $commit
            echo
          done
        else
          echo "$commits"
          echo
        fi
    fi
}

for repo in $(ls $repos); do
    if [ -d "$repos/$repo" ]; then
        pushd $repos/$repo > /dev/null

        print_commits $repos/$repo

        popd >/dev/null
    fi
done
