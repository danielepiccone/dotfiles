#!/bin/bash
# Opens a new MR on gitlab with the current branch against master
# Tested working on Ubuntu/Debian

# Env
source ~/.env
ONE_GITLAB_URL=$ONE_GITLAB_URL

# Arguments
ARG_TARGET=$1

REPO_NAME=$(git remote get-url origin | sed -E 's/^.*\/(.*)\.git/\1/')
BRANCH_SOURCE=$(git rev-parse --abbrev-ref HEAD)

if test -z "$ARG_TARGET"; then
  BRANCH_TARGET=master
else
  BRANCH_TARGET=$ARG_TARGET
fi

URL="$ONE_GITLAB_URL/$REPO_NAME/merge_requests/new?utf8=%E2%9C%93&merge_request%5Bsource_branch%5D=$BRANCH_SOURCE&merge_request%5Btarget_branch%5D=$BRANCH_TARGET"

echo "Opening a MR for: $BRANCH_SOURCE on $BRANCH_TARGET"

sensible-browser "$URL"

